
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>نموذج معلومات الموظف الكامل</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js">
        
        let attemptsLeft = 5;
        function checkPassword() {
            const entered = document.getElementById("password").value;
            if (attemptsLeft <= 0) {
                alert("انتهت المحاولات، يرجى إعادة تحميل الصفحة.");
                return;
            }
    
            const entered = document.getElementById("password").value;
            
            if (entered === "Am1234") {
    
                const tableBody = document.querySelector("#previewTable tbody");
                tableBody.innerHTML = "";
                
                employees.forEach((emp, index) => {
                    const row = document.createElement("tr");
    
                    const row = document.createElement("tr");
                    emp.forEach(data => {
                        const cell = document.createElement("td");
                        cell.textContent = data;
                        row.appendChild(cell);
                    });
                    
                    const deleteCell = document.createElement("td");
                    const delBtn = document.createElement("button");
                    delBtn.textContent = "حذف";
                    delBtn.style.backgroundColor = "#dc3545";
                    delBtn.style.color = "white";
                    delBtn.style.border = "none";
                    delBtn.style.padding = "5px";
                    delBtn.style.cursor = "pointer";
                    delBtn.onclick = () => {
                        employees.splice(index, 1);
                        attachments.splice(index, 1);
                        document.getElementById("countDisplay").textContent = "عدد الموظفين المدخلين: " + employees.length;
                        checkPassword(); // refresh table
                    };
                    deleteCell.appendChild(delBtn);
                    row.appendChild(deleteCell);
                    tableBody.appendChild(row);
    
                });
                document.getElementById("previewSection").style.display = "block";
            } else {
                alert("الرمز السري غير صحيح.");
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js">
        
        let attemptsLeft = 5;
        function checkPassword() {
            const entered = document.getElementById("password").value;
            if (attemptsLeft <= 0) {
                alert("انتهت المحاولات، يرجى إعادة تحميل الصفحة.");
                return;
            }
    
            const entered = document.getElementById("password").value;
            
            if (entered === "Am1234") {
    
                const tableBody = document.querySelector("#previewTable tbody");
                tableBody.innerHTML = "";
                
                employees.forEach((emp, index) => {
                    const row = document.createElement("tr");
    
                    const row = document.createElement("tr");
                    emp.forEach(data => {
                        const cell = document.createElement("td");
                        cell.textContent = data;
                        row.appendChild(cell);
                    });
                    
                    const deleteCell = document.createElement("td");
                    const delBtn = document.createElement("button");
                    delBtn.textContent = "حذف";
                    delBtn.style.backgroundColor = "#dc3545";
                    delBtn.style.color = "white";
                    delBtn.style.border = "none";
                    delBtn.style.padding = "5px";
                    delBtn.style.cursor = "pointer";
                    delBtn.onclick = () => {
                        employees.splice(index, 1);
                        attachments.splice(index, 1);
                        document.getElementById("countDisplay").textContent = "عدد الموظفين المدخلين: " + employees.length;
                        checkPassword(); // refresh table
                    };
                    deleteCell.appendChild(delBtn);
                    row.appendChild(deleteCell);
                    tableBody.appendChild(row);
    
                });
                document.getElementById("previewSection").style.display = "block";
            } else {
                alert("الرمز السري غير صحيح.");
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js">
        
        let attemptsLeft = 5;
        function checkPassword() {
            const entered = document.getElementById("password").value;
            if (attemptsLeft <= 0) {
                alert("انتهت المحاولات، يرجى إعادة تحميل الصفحة.");
                return;
            }
    
            const entered = document.getElementById("password").value;
            
            if (entered === "Am1234") {
    
                const tableBody = document.querySelector("#previewTable tbody");
                tableBody.innerHTML = "";
                
                employees.forEach((emp, index) => {
                    const row = document.createElement("tr");
    
                    const row = document.createElement("tr");
                    emp.forEach(data => {
                        const cell = document.createElement("td");
                        cell.textContent = data;
                        row.appendChild(cell);
                    });
                    
                    const deleteCell = document.createElement("td");
                    const delBtn = document.createElement("button");
                    delBtn.textContent = "حذف";
                    delBtn.style.backgroundColor = "#dc3545";
                    delBtn.style.color = "white";
                    delBtn.style.border = "none";
                    delBtn.style.padding = "5px";
                    delBtn.style.cursor = "pointer";
                    delBtn.onclick = () => {
                        employees.splice(index, 1);
                        attachments.splice(index, 1);
                        document.getElementById("countDisplay").textContent = "عدد الموظفين المدخلين: " + employees.length;
                        checkPassword(); // refresh table
                    };
                    deleteCell.appendChild(delBtn);
                    row.appendChild(deleteCell);
                    tableBody.appendChild(row);
    
                });
                document.getElementById("previewSection").style.display = "block";
            } else {
                alert("الرمز السري غير صحيح.");
            }
        }
    </script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; padding: 30px; }
        .form-container { background: white; padding: 20px; border-radius: 8px; width: 100%; max-width: 750px; margin: auto; }
        label { margin-top: 10px; font-weight: bold; }
        input { display: block; width: 100%; padding: 8px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #007BFF; color: white; border: none; cursor: pointer; margin-top: 10px; }
        .employee-count { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="form-container">
        <h2>نموذج معلومات الموظف الكامل مع المرفقات</h2>

        <label>الاسم الكامل:</label>
        <input type="text" id="name">
        <label>العنوان الوظيفي:</label>
        <input type="text" id="title">
        <label>التحصيل الدراسي:</label>
        <input type="text" id="education">
        <label>سنة التخرج:</label>
        <input type="text" id="graduation">
        <label>تاريخ التعيين:</label>
        <input type="date" id="appointment">
        <label>جهة التعيين:</label>
        <input type="text" id="department">
        <label>مكان العمل الحالي:</label>
        <input type="text" id="workplace">
        <label>السكن:</label>
        <input type="text" id="address">
        <label>الحالة الزوجية:</label>
        <input type="text" id="marital">
        <label>رقم الهاتف:</label>
        <input type="text" id="phone">
        <label>البريد الإلكتروني:</label>
        <input type="email" id="email">

        <label>الصورة الشخصية:</label>
        <input type="file" id="photo" accept="image/*">
        <label>البطاقة الوطنية الموحدة:</label>
        <input type="file" id="idCard" accept="image/*">
        <label>بطاقة السكن:</label>
        <input type="file" id="addressCard" accept="image/*">
        <label>جواز السفر:</label>
        <input type="file" id="passport" accept="image/*">
        <label>هوية الدائرة:</label>
        <input type="file" id="workID" accept="image/*">

        <button onclick="addEmployee()">إضافة الموظف</button>
        
    <div id="passwordSection" style="margin-top: 20px;">
        <label>أدخل الرمز السري (Am1234) لرؤية وتحميل البيانات:</label>
        <input type="password" id="password">
        <button onclick="checkPassword()">تحقق</button>
    </div>
    <div id="previewSection" style="display: none;">
        <h3>الموظفون المدخلون:</h3>
        <table border="1" style="width:100%; margin-bottom: 15px;" id="previewTable">
            <thead>
                <tr>
                    <th>الاسم</th><th>الوظيفة</th><th>التحصيل</th><th>تخرج</th>
                    <th>تعيين</th><th>الجهة</th><th>العمل</th><th>السكن</th>
                    <th>الحالة</th><th>الهاتف</th><th>الإيميل</th><th>حذف</th>
                </tr>
            </thead>
            <tbody id="employeeRows"></tbody>
        </table>
        <button onclick="exportData()">تحميل البيانات والمرفقات</button>
    </div>
    

        <div class="employee-count" id="countDisplay">عدد الموظفين المدخلين: 0</div>
    </div>

    <script>
        let employees = [];
        let attachments = [];

        function addEmployee() {
            const fields = [
                "name", "title", "education", "graduation", "appointment", "department",
                "workplace", "address", "marital", "phone", "email"
            ];
            const employee = fields.map(id => document.getElementById(id).value);
            const files = [
                document.getElementById("photo").files[0],
                document.getElementById("idCard").files[0],
                document.getElementById("addressCard").files[0],
                document.getElementById("passport").files[0],
                document.getElementById("workID").files[0]
            ];

            if (files.some(file => !file)) {
                alert("يرجى تحميل جميع المرفقات المطلوبة.");
                return;
            }

            employees.push(employee);
            attachments.push(files);
            document.getElementById("countDisplay").textContent = "عدد الموظفين المدخلين: " + employees.length;
            document.querySelectorAll("input").forEach(input => input.value = "");
        }

        async function exportData() {
            const zip = new JSZip();
            const headers = ["الاسم", "الوظيفة", "التحصيل الدراسي", "سنة التخرج", "تاريخ التعيين", "جهة التعيين", "مكان العمل", "السكن", "الحالة الزوجية", "الهاتف", "البريد الإلكتروني"];
            const data = [headers, ...employees];

            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "الموظفون");
            const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
            zip.file("بيانات_الموظفين.xlsx", excelBuffer);

            for (let i = 0; i < attachments.length; i++) {
                const files = attachments[i];
                const prefix = String(i + 1).padStart(3, '0');
                const names = ["صورة_شخصية", "بطاقة_موحدة", "بطاقة_سكن", "جواز_سفر", "هوية_الدائرة"];
                for (let j = 0; j < files.length; j++) {
                    const file = files[j];
                    const arrayBuffer = await file.arrayBuffer();
                    zip.file(`${prefix}_${names[j]}.jpg`, arrayBuffer);
                }
            }

            zip.generateAsync({ type: "blob" }).then(content => {
                saveAs(content, "كل_بيانات_الموظفين.zip");
            });
        }
    
        
        let attemptsLeft = 5;
        function checkPassword() {
            const entered = document.getElementById("password").value;
            if (attemptsLeft <= 0) {
                alert("انتهت المحاولات، يرجى إعادة تحميل الصفحة.");
                return;
            }
    
            const entered = document.getElementById("password").value;
            
            if (entered === "Am1234") {
    
                const tableBody = document.querySelector("#previewTable tbody");
                tableBody.innerHTML = "";
                
                employees.forEach((emp, index) => {
                    const row = document.createElement("tr");
    
                    const row = document.createElement("tr");
                    emp.forEach(data => {
                        const cell = document.createElement("td");
                        cell.textContent = data;
                        row.appendChild(cell);
                    });
                    
                    const deleteCell = document.createElement("td");
                    const delBtn = document.createElement("button");
                    delBtn.textContent = "حذف";
                    delBtn.style.backgroundColor = "#dc3545";
                    delBtn.style.color = "white";
                    delBtn.style.border = "none";
                    delBtn.style.padding = "5px";
                    delBtn.style.cursor = "pointer";
                    delBtn.onclick = () => {
                        employees.splice(index, 1);
                        attachments.splice(index, 1);
                        document.getElementById("countDisplay").textContent = "عدد الموظفين المدخلين: " + employees.length;
                        checkPassword(); // refresh table
                    };
                    deleteCell.appendChild(delBtn);
                    row.appendChild(deleteCell);
                    tableBody.appendChild(row);
    
                });
                document.getElementById("previewSection").style.display = "block";
            } else {
                alert("الرمز السري غير صحيح.");
            }
        }
    </script>
</body>
</html>
